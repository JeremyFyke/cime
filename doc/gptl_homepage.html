<html>
<head>
<title>GPTL timing library Home Page</title>
<meta name="description" content="Profile multi-threaded and multi-tasked 
C, C++, and Fortran codes. Optional PAPI interface. Automatically generate a
dynamic call tree">
<meta name="Keywords" content="gptl","papi","call tree","profile","timing","performance analysis">
<meta name="Author" content="Jim Rosinski">
<h1>GPTL - General Purpose Timing Library</h1>
<h2>(with optional PAPI interface)</h2>
</head>
<body bgcolor="peachpuff">

<HR SIZE=2 WIDTH="100%" ALIGN="LEFT" NOSHADE>
<h2>Description</h2>
<b>GPTL</b> is a library to instrument C, C++, and Fortran codes for
    performance analysis and profiling. The instrumentation can be inserted
    manually by the user wherever they wish, or it can be done automatically
    by the compiler at
    function entry and exit points if the application being
    profiled is built 
    with either the GNU or PathScale compilers. To auto-instrument an
    application,
    add <b><em>-finstrument-functions</em></b> to 
    the compile flags of the source files to be profiled. Here is a portion of
    <b>GPTL</b> printout after running the HPCC benchmark with automatic
    instrumentation enabled: 
<pre>
<div style="background-color:white;">
Stats for thread 0:
                                             Called  Recurse Wallclock max       min       
  total                                            1     -      64.325    64.325    64.325 
    HPCC_Init                                     11      10     0.027     0.027     0.000 
*     HPL_pdinfo                                 120     118     0.008     0.007     0.000 
*       HPL_all_reduce                             7     -       0.007     0.005     0.000 
*         HPL_broadcast                           21     -       0.079     0.066     0.000 
        HPL_pdlamch                                2     -       0.002     0.001     0.000 
*       HPL_fprintf                              240     120     0.001     0.000     0.000 
      HPCC_InputFileInit                          41      40     0.000     0.000     0.000 
        ReadInts                                   2     -       0.000     0.000     0.000 
    PTRANS                                        22      21    22.812    22.812     0.000 
      MaxMem                                       5       4     0.000     0.000     0.000 
*     iceil_                                     132     -       0.000     0.000     0.000 
*     ilcm_                                       14     -       0.000     0.000     0.000 
      param_dump                                  18      12     0.000     0.000     0.000 
      Cblacs_get                                   5     -       0.000     0.000     0.000 
      Cblacs_gridmap                              35      30     0.005     0.001     0.000 
*       Cblacs_pinfo                               7       1     0.000     0.000     0.000 
*     Cblacs_gridinfo                             60      50     0.000     0.000     0.000 
      Cigsum2d                                     5     -       0.148     0.060     0.000 
      pdmatgen                                    20     -      21.717     1.277     0.850 
*       numroc_                                   96     -       0.000     0.000     0.000 
*       setran_                                   25     -       0.000     0.000     0.000 
*       pdrand                               3.9e+06   3e+06    15.842     0.076     0.000 
        xjumpm_                                55349   55169     0.162     0.023     0.000 
        jumpit_                                60900   40600     0.329     0.020     0.000 
...
</div>
</pre>
    Function names on the left of the output are indented to indicate their
    parent, and depth in the call tree. An asterisk next to an entry means it
    has more than one parent (see <A HREF="example2.html">Example 2</A> for
    further details). Other entries in this output show the number of
    invocations, number of recursive invocations, and wallclock timing
    statistics.
<p>
    If the <a HREF="http://icl.cs.utk.edu/papi">PAPI</a> library is
    installed on the target platform, <b>GPTL</b> can be used to
    access all available <b>PAPI</b> events.
    To count floating point operations for example, one need only add
    a call that looks like: 

    <pre>
    ret = GPTLsetoption (PAPI_FP_OPS, 1);
    </pre>

    The second argument "1" in the above call means "enable". Any non-zero
    integer means "enable", and a zero means "disable".
    Multiple <b>GPTL</b> or <b>PAPI</b> options can be specified with additional
    calls to <b>GPTLsetoption()</b>. The man pages provided with the
    distribution describe the full API specification for each <b>GPTL</b>
    function. The interface is identical for both Fortran and C/C++ 
    codes, modulo the case-insensitivity of Fortran. 
<p>
    Calls to <b>GPTLstart()</b> and <b>GPTLstop()</b> can be nested to an
    arbitrary depth. As shown above, <b>GPTL</b> handles nested regions by
    presenting output in an indented fashion. The example also shows how
    auto-instrumentation 
    can be used to easily produce a dynamic call tree of
    the application being profiled, where region names correspond to function
	entry and exit points.

<HR SIZE=2 WIDTH="100%" ALIGN="LEFT" NOSHADE>
<h2>What's new in the latest release (<a href="gptl3_5.tar.gz">gptl3_5.tar.gz</a>)</h2>
<ul>
<li> Options for call-tree generation based on number of invocations per
parent: most_frequent (default), first_parent, last_parent, full_tree. 
Previous GPTL versions always used first_parent. New option <em>full_tree</em> can
produce <b>tons</b> of output depending the nature of the call tree. But it
can also be very useful because it shows all parent-child relationships.
<li> Derived events based on PAPI:
  <ul>
  <li> L2 miss rate (GPTL_L2MRT)
  <li> Load-stores per L2 miss (GPTL_LSTPL2M)
  <li> L3 miss rate (GPTL_L3MRT)
  </ul>
<li> New subroutine <b>gptlprocess_namelist()</b> enables Fortran codes to
use a namelist to set <b>GPTL</b> options. This allows changing settings
without having to recompile or relink application codes. See
ftests/nlreader.F for example usage. An example namelist file is
ftests/gptlnl. 
<li> New function <b>GPTLget_eventvalue()</b> allows an application to query
the current value of any PAPI-based event, including derived events.
<li> <em><b>parsegptlout.pl</b></em> now takes header name as an argument rather
than an integer index.
</ul>
<h2>What was new in the previous release (<a href="gptl3_4_7.tar.gz">gptl3_4_7.tar.gz</a>)</h2>
<ul>
<li> Derived events based on PAPI:
  <ul>
  <li> Computational intensity (GPTL_CI)
  <li> Instructions per cycle (GPTL_IPC)
  <li> FP ops per cycle (GPTL_FPC)
  <li> FP ops per instruction (GPTL_FPI)
  <li> Load-store instruction fraction (GPTL_LSTPI)
  <li> L1 miss rate (GPTL_DCMRT)
  <li> Load-stores per L1 miss (GPTL_LSTPDCM)
  </ul>
<li> New entry points GPTLevent_code_to name() and GPTLevent_name_to_code()
<li> Ability to disable portions of printed output (e.g. GPTLdopr_preamble)
<li> Better description of enabled events
</ul>

<HR SIZE=2 WIDTH="100%" ALIGN="LEFT" NOSHADE>
<h2>Features</h2>
<ul>
<li> Low overhead.
<li> No external dependencies (<b>PAPI</b> interface is optional).
<li> Automatically multiplexes requested <b>PAPI</b> counters when required.
<li> Thread-safe, and reports per-thread statistics for multi-threaded
	codes.
<li> Includes utility functions to print memory usage
	(<b>GPTLprint_memusage()</b>) and get timestamps (<b>GPTLstamp()</b>).
<li> Includes utility scripts to post-process multi-threaded and
	multi-tasked output for easy assessment of load balance
	characteristics.
<li> Support for derived (<b>PAPI</b>-based) events such as computational
	intensity and instructions per cycle. Run ctests/avail to list
	available events.
</ul>

<HR SIZE=2 WIDTH="100%" ALIGN="LEFT" NOSHADE>
<h2>Download and Installation</h2>
<ul> 
<li> Download the most recent release by clicking this link: <a href="gptl3_5.tar.gz">gptl3_5.tar.gz</a>.
<li> Earlier versions can be found <a href="older/">here</a>.
<li> To build and install <b>GPTL</b>, see the <A HREF="../INSTALL">INSTALL</a> file.
  You'll need to create a <b><em>macros.make</em></b> file appropriate for your target
  platform. Example files for various architectures are
  included in the tar file (e.g. <b><em>macros.make.linux</em></b>). An autoconf-based 
  script named <b><em>suggestions</em></b> is included to help in editing this
  file. Example usage might be:
<pre>
./suggestions FC=gfortran CC=gcc
</pre>
Comments in the sample <b><em>macros.make</em></b> files describe 
  each required setting.
<li> For information on using <b>GPTL</b>, refer to 
  <A HREF="#EXAMPLES">EXAMPLES</A> below, and the man pages provided with the
  distribution. 
</ul>

<HR SIZE=2 WIDTH="100%" ALIGN="LEFT" NOSHADE>
<A name=EXAMPLES></A>
<h2>Examples</h2>
  These pages contain simple codes which illustrate the use of some features of
  <b>GPTL</b>. All examples were run on a Linux x86 using GNU compilers. 
  <p>
  <A HREF="example1.html">Example 1</A> is a manually-instrumented
  Fortran code which uses <b>PAPI</b> to count floating point
  operations. 
  <p>
  <A HREF="example2.html">Example 2</A> is a C code compiled
  with gcc's auto-instrumentation hooks to print a dynamic call tree. 
  <p>
  <A HREF="example3.html">Example 3</A> is a simple MPI code, the
  output of which is post-processed using Perl script
  <em><b>parsegpltout.pl</b></em> to examine load imbalance.

<HR SIZE=2 WIDTH="100%" ALIGN="LEFT" NOSHADE>

<h2>Bug Reports</h2>
Please <a HREF="mailto:rosinskijm@ornl.gov">email</a> me bug reports
	and/or feature requests.

<h2>Author</h2>
<b>GPTL</b> was written
by <a HREF="http://www.burningserver.net/rosinski">Jim Rosinski</a>,
currently at <a HREF="http://www.ornl.gov">ORNL</a>, formerly
  at <a HREF="http://www.sicortex.com">SiCortex</a>,
and <a HREF="http://www.ucar.edu">NCAR</a>. 
<h2>Copyright</h2>
This software is <b>Open Source</b>. My only request is that you don't
embed <b>GPTL</b> library source itself in software that you intend to sell.

<hr />
<a href="example1.html"><img border="0" src="btn_next.gif"
			     width="100" height="20" alt="Example 1" /></a>

<br />
</html>
