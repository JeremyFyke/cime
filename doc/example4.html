<html>
<head>
<title>GPTL usage example 4</title>
<meta name="example" content="Automatic GPTL instrumentation C++">
<meta name="Keywords" content="gptl","papi","call tree","profile","timing","performance analysis">
<meta name="Author" content="Jim Rosinski">
</head>
<body bgcolor="peachpuff">

<hr />
<a href="example3.html"><img border="0" src="btn_previous.gif"
				  width="100" height="20" alt="Previous"
				  /></a> 
<a href="gptl_homepage.html"><img border="0" src="btn_next.gif"
			     width="100" height="20" alt="GPTL home page" /></a>

<br />

<h2>Example 4: Auto-instrumentation</h2>
This example is a C++ code compiled with auto-instrumentation enabled. Note
that the constructor and destructor for X are inside the class definition,
and outside the class definition for Y.
<p>
<b><em>profcxx.C:</em></b>
<pre>
<div style="background-color:white;">
#include &#60../gptl.h&gt
#include &#60myclasses.h&gt

int main ()
{
  X *x;
  Y *y;
  int ret;

  ret = GPTLinitialize ();
  ret = GPTLstart ("total");

  x = new (X);
  x->func (1.2);
  x->func (1);
  delete (x);

  y = new (Y);
  y->func (1.2);
  y->func (1);
  delete (y);

  ret = GPTLstop ("total");
  ret = GPTLpr (0);
}

</div>
</pre>

<b><em>myclasses.h:</em></b>
<div style="background-color:white;">
<pre>
class Base
{
 public:
  Base ();
  ~Base ();
};

Base::Base ()
{
}

Base::~Base ()
{
}

class X: Base
{
 public:
  X () 
  {
  }
  ~X() 
  {
  }
  void func (int x)
  {
  }
  void func (double x)
  {
  }
};

class Y: Base
{
 public:
  Y ();
  ~Y();
  void func (int);
  void func (double);
};

Y::Y ()
{
}

Y::~Y()
{
}

void Y::func (int x)
{
}

void Y::func (double x)
{
}
</div>
</pre>
Compile all but <em>main.c</em> with auto-instrumentation, then link and
run. Useful auto-instrumentation of the main program is not possible,
because the call to <b>GPTLinitialize()</b> must be done manually and
needs to preceed all calls to <b>GPTLstart</b> and <b>GPTLstop</b>. 
<pre>
% g++ -finstrument-functions profcxx.C -o profcxx -lgptl
% ./profcxx
</pre>

Now convert the auto-instrumented output to human-readable form:
<pre>
% hex2name.pl profcxx timing.0 > timing.0.converted
</pre>

Output file <em>timing.0.converted</em> looks like this:
<pre>
<div style="background-color:white;">
</div>
</pre>
<h3>Explanation of the above output</h3>

<hr />
<a href="example3.html"><img border="0" src="btn_previous.gif"
				  width="100" height="20" alt="Previous"
				  /></a> 
<a href="gptl_homepage.html"><img border="0" src="btn_next.gif"
			     width="100" height="20" alt="GPTL home page" /></a>

<br />

</html>
