<html>
<head>
<title>GPTL usage example 5: Fortran use of gptlparse_namelist() to set GPTL options</title>
<meta name="example" content="gptlparse_namelist Fortran">
<meta name="Keywords" content="gptl","papi","call tree","profile","timing","performance analysis">
<meta name="Author" content="Jim Rosinski">
</head>
<body bgcolor="peachpuff">

<hr />
<a href="example4.html"><img border="0" src="btn_previous.gif"
				  width="100" height="20" alt="Example 4"
				  /></a> 
<a href="gptl_homepage.html"><img border="0" src="btn_next.gif"
			     width="100" height="20" alt="GPTL home page" /></a>

<br />

<h2>Example 5: Fortran use of gptlparse_namelist() to set GPTL options</h2>
This example is a Fortran code which uses convenience
function <b>gptlparse_namelist()</b> to set <b>GPTL</b> options instead of inserting
calls to <b>gptlsetoption()</b> into the application code.
<p>
<b><em>nlreader.F:</em></b>
<pre>
<div style="background-color:white;">
      program nlreader
      implicit none

      include 'gptl.inc'

      integer :: ret

      call gptlprocess_namelist ('gptlnl', 1, ret)
      if (ret /= 0) then
        write(6,*)'GPTL namelist read failure'
        call exit (1)
      end if
      
      ret = gptlsetoption (gptlverbose, 0)
      ret = gptlinitialize ()
      end program nlreader
</div>
</pre>
Next are the contents of the namelist file. Note that <em>verbose = 1</em>,
which results in printout when each namelist variable is set. The namelist
group name must always be <em>gptlnl</em>.
<p>
<b><em>gptlnl:</em></b>
<pre>
<div style="background-color:white;">
&gptlnl
! These settings are all the opposite of the default--for testing
 wall            = .false.
 cpu             = .true.
 abort_on_error  = .true.
 overhead        = .true.
 depthlimit      = 1
 verbose         = .true.
 narrowprint     = .false.
 percent         = .true.
! Comment out persec and multiplex so "nlreader" test won't fail even if 
!   PAPI unavailable
! persec          = .false.
! multiplex       = .true.
 dopr_preamble   = .false.
 dopr_threadsort = .false.
 dopr_multparent = .false.
 dopr_collision  = .false.

! utr, print_method, and eventlist use character variables instead of integer 
! to avoid "magic number" settings in the namelist

 utr             = 'nanotime'
 print_method    = 'full_tree'
!print_method    = 'first_parent'
!print_method    = 'last_parent'
!print_method    = 'most_frequent'  ! default

! Comment out eventlist so "nlreader" test won't fail even if PAPI unavailable
! eventlist       = 'PAPI_FP_OPS','GPTL_CI'
/
</div>
</pre>
Now compile and run:
<pre>
<div>
% mpif90 -fopenmp -o nlreader nlreader.F -lgptl
% ./nlreader
</div>
</pre>

Here's the output:
<pre>
<div style="background-color:white;">
GPTLsetoption: boolean verbose = 1
GPTLsetoption: boolean abort_on_error = 1
GPTLsetoption: boolean wallstats = 0
GPTLsetoption: cpustats = 1
GPTLsetoption: depthlimit = 1
GPTLsetoption: boolean percent = 1
GPTLsetoption: boolean dopr_preamble = 0
GPTLsetoption: boolean dopr_threadsort = 0
GPTLsetoption: boolean dopr_multparent = 0
GPTLsetoption: boolean dopr_collision = 0
GPTLsetutr: underlying wallclock timer = nanotime
GPTLsetoption: print_method = full_tree
 gptlprocess_namelist: skipping check for PAPI-based events because GPTL was built without PAPI support
</div>
</pre>
<h3>Explanation of the above output</h3>
Each namelist setting results in a call to <b>GPTLsetoption()</b>
or <b>GPTLsetutr</b> with the listed value. The advantage to this approach is
that it bypasses the need for recompilation when changing <b>GPTL</b> settings.
<hr />
<a href="example3.html"><img border="0" src="btn_previous.gif"
				  width="100" height="20" alt="Example 3"
				  /></a> 
<a href="gptl_homepage.html"><img border="0" src="btn_next.gif"
			     width="100" height="20" alt="GPTL home page" /></a>

<br />

</html>
