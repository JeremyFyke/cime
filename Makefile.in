CC       = @CC@
CFLAGS   = @CFLAGS@ @THREADFLAGS@ @FDEFS@ @THREADDEFS@ @DEFS@ @PAPIPREP@ @BITFLAGS@

LIBNAME  = libgptl.a
LIBDIR   = @prefix@/lib
INCDIR   = @prefix@/include
MANDIR   = @prefix@/man/man3
OBJS     = camwrappers.o f_wrappers.o gptl.o util.o threadutil.o get_memusage.o \
           print_memusage.o @PAPIOBJS@
@SET_MAKE@

$(LIBNAME): $(OBJS)
	ar @ARFLAGS@ $@ $(OBJS)
	rm -f ctests/*.o ftests/*.o

all: $(LIBNAME) tests/all

install: $(LIBNAME)
	cp $(LIBNAME) $(LIBDIR)
	cp gptl.h gptl.inc $(INCDIR)
	cp man/man3/*.3 $(MANDIR)

uninstall:
	rm $(LIBDIR)/$(LIBNAME) $(INCDIR)/gptl.h $(INCDIR)/gptl.inc

cests/all:
	(cd ctests && $(MAKE) all)

fests/all:
	(cd ftests && $(MAKE) all)

clean:
	rm $(OBJS) gptl_papi.o $(LIBNAME)
	(cd ctests && $(MAKE) clean)
	(cd ftests && $(MAKE) clean)

camwrappers.o: gptl.h private.h
f_wrappers.o: gptl.h private.h
gptl.o: gptl.h private.h
util.o: gptl.h private.h
threadutil.o: gptl.h private.h
gptl_papi.o: gptl.h private.h
