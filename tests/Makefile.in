CC           = @CC@
CFLAGS       = @CFLAGS@ @PAPIPREP@ @BITFLAGS@
THREADFLAGS  = @THREADFLAGS@ @THREADDEFS@
LDFLAGS      = -L.. -lgpt @LIBS@ @LDFLAGS@ @CFLAGS@ @THREADFLAGS@ @BITFLAGS@

FC           = @F77@
FFLAGS       = @FFLAGS@ @PAPIPREP@ @BITFLAGS@
FTHREADFLAGS = @FTHREADFLAGS@
FLDFLAGS     = -L.. -lgpt @LIBS@ @LDFLAGS@ @THREADFLAGS@ @BITFLAGS@

COBJS = llcost.o depth.o overhead.o
CEXES = llcost   depth   overhead

FOBJS = flopsperclock.o omptest.o errtest.o opscost.o \
        hashtest.o papitest.o
FEXES = flopsperclock   omptest   errtest   opscost \
        hashtest   papitest

all: $(CEXES) $(FEXES)
cexes: $(CEXES)
fexes: $(FEXES)

llcost: llcost.o
	$(CC) -o $@ llcost.o $(CFLAGS) $(LDFLAGS)
depth: depth.o
	$(CC) -o $@ depth.o $(CFLAGS) $(LDFLAGS)
overhead: overhead.o
	$(CC) -o $@ overhead.o $(CFLAGS) $(THREADFLAGS) $(LDFLAGS)
flopsperclock: flopsperclock.o
	$(FC) -o $@ flopsperclock.o $(FFLAGS) $(FLDFLAGS)
omptest: omptest.o
	$(FC) -o $@ omptest.o $(FFLAGS) $(FTHREADFLAGS) $(FLDFLAGS)
errtest: errtest.o
	$(FC) -o $@ errtest.o $(FFLAGS) $(FLDFLAGS)
opscost: opscost.o
	$(FC) -o $@ opscost.o $(FFLAGS) $(FLDFLAGS)
hashtest: hashtest.o
	$(FC) -o $@ hashtest.o $(FFLAGS) $(FTHREADFLAGS) $(FLDFLAGS)
papitest: papitest.o
	$(FC) -o $@ papitest.o $(FFLAGS) $(FTHREADFLAGS) $(FLDFLAGS)

clean:
	rm $(FOBJS) $(COBJS) $(FEXES) $(CEXES)

# Add appropriate thread flags to threaded executables

overhead.o: overhead.c
	$(CC) -c $(CFLAGS) $(THREADFLAGS) $<
papitest.o: papitest.F
	$(FC) -c $(FFLAGS) $(FTHREADFLAGS) $<
omptest.o: omptest.F
	$(FC) -c $(FFLAGS) $(FTHREADFLAGS) $<
